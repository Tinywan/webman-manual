# Руководство по обновлению до версии 1.4

**Перед обновлением обязательно сделайте резервную копию, выполните следующую команду для обновления:**
`composer require workerman/webman-framework ^1.4.7 && composer require webman/console ^1.2.12 && php webman install`

> **Примечание**
Если обновление невозможно, возможно, что вы используете прокси-сервер composer, в таком случае воспользуйтесь следующей командой: `composer config -g --unset repos.packagist` для восстановления использования официального источника данных composer.

# Особенности и изменения функционала

## Плагины приложений
В версии 1.4 добавлена поддержка плагинов приложений, для получения более подробной информации обратитесь к [Плагины приложений](../plugin/app.md)

## Автоматическая маршрутизация
В версии 1.4 добавлена поддержка различных сложных правил директорий контроллеров, например:
```
app
├── admin
│   └── v1
│       └── v2
│           └── v3
│               └── controller
│                   └── Index.php
└── controller
    ├── v1
    │   └── Index.php
    └── v2
        └── v3
            └── Index.php
```
Это означает, что плагин `webman/auto-route` больше не нужен

## Переключатель повторного использования контроллеров
В версии 1.4 добавлена возможность отключения повторного использования контроллеров, установив `'controller_reuse' => false` в `config/app.php`. Таким образом, каждый запрос будет инициализировать новый экземпляр контроллера, то есть каждый запрос будет вызывать конструктор `__construct()` соответствующего контроллера, что позволяет разработчикам инициализировать обработку запроса перед выполнением каждого запроса.

Из-за возможности отключения повторного использования контроллеров плагин `webman/action-hook` больше не требуется.

## Запуск службы http
В версии 1.4 добавлена поддержка запуска нескольких портов для предоставления службы http.
См. [Обработка медленных запросов](../others/task.md)

## Конфигурация файлов представлений
Расширение теперь можно настроить только в разделе options файла `view.php`.
**Устаревший подход**
```php
use support\view\Raw;
return [
    'handler' => Raw::class,
    'view_suffix' => '.php'
];
```
**Правильный подход**
```php
use support\view\Raw;
return [
    'handler' => Raw::class,
    'options' => [
        'view_suffix' => '.php'
    ]
];
```

## Пространство имён драйвера сессий
Начиная с версии 1.4.0 webman изменил пространство имён класса `SessionHandler` с
```php
use Webman\FileSessionHandler;  
use Webman\RedisSessionHandler;  
use Webman\RedisClusterSessionHandler;  
```
на
```php
use Webman\Session\FileSessionHandler;  
use Webman\Session\RedisSessionHandler;  
use Webman\Session\RedisClusterSessionHandler;
```

Чтобы избежать непосредственных ошибок после обновления, класс `Webman\FileSessionHandler` продолжает существовать в течение некоторого времени и будет полностью удален в будущих версиях.

Это изменение влияет на конфигурацию `'handler'` в `config/session.php`.
