# Компонент планировщика задач crontab

## workerman/crontab

### Описание

`workerman/crontab` подобен crontab в Linux, но отличие заключается в том, что `workerman/crontab` поддерживает планирование по секундам.

Описание времени:

```
0   1   2   3   4   5
|   |   |   |   |   |
|   |   |   |   |   +------ день недели (0 - 6) (Воскресенье=0)
|   |   |   |   +------ месяц (1 - 12)
|   |   |   +-------- день месяца (1 - 31)
|   |   +---------- час (0 - 23)
|   +------------ минута (0 - 59)
+-------------- секунда (0-59)[может быть пропущена, если 0 не указан, то минимальный интервал - минута]
```

### Ссылка на проект

https://github.com/walkor/crontab

### Установка

```php
composer require workerman/crontab
```

### Использование

**Шаг 1: Создать файл процесса `process/Task.php`**

```php
<?php
namespace process;

use Workerman\Crontab\Crontab;

class Task
{
    public function onWorkerStart()
    {
    
        // Выполнять каждую секунду
        new Crontab('*/1 * * * * *', function(){
            echo date('Y-m-d H:i:s')."\n";
        });
        
        // Выполнять каждые 5 секунд
        new Crontab('*/5 * * * * *', function(){
            echo date('Y-m-d H:i:s')."\n";
        });
        
        // Выполнять каждую минуту
        new Crontab('0 */1 * * * *', function(){
            echo date('Y-m-d H:i:s')."\n";
        });
        
        // Выполнять каждые 5 минут
        new Crontab('0 */5 * * * *', function(){
            echo date('Y-m-d H:i:s')."\n";
        });
        
        // Выполнять в первую секунду каждой минуты
        new Crontab('1 * * * * *', function(){
            echo date('Y-m-d H:i:s')."\n";
        });
      
        // Выполнять в 7:50 каждый день, обратите внимание, что здесь пропущен разряд секунд
        new Crontab('50 7 * * *', function(){
            echo date('Y-m-d H:i:s')."\n";
        });
        
    }
}
```

**Шаг 2: Настроить запуск файлов процесса вместе с webman**

Откройте файл конфигурации `config/process.php` и добавьте следующую конфигурацию

```php
return [
    ....другие настройки, здесь пропущены....
  
    'task'  => [
        'handler'  => process\Task::class
    ],
];
```

**Шаг 3: Перезапустить webman**

> Примечание: Задачи планировщика не будут выполнены немедленно, все задачи планировщика начнут выполняться после перехода на следующую минуту.

### Примечание
crontab не является асинхронным, например, в процессе задач заданы два таймера A и B, оба выполняются каждую секунду, но если задача A занимает 10 секунд, то задача B должна ждать завершения задачи A, что приведет к задержке выполнения задачи B.
Если бизнес-логика зависит от чувствительности к времени, рекомендуется запускать чувствительные к времени задачи в отдельном процессе, чтобы избежать влияния других задач. Например, в файле `config/process.php` сделать следующую настройку:

```php
return [
    ....другие настройки, здесь пропущены....
  
    'task1'  => [
        'handler'  => process\Task1::class
    ],
    'task2'  => [
        'handler'  => process\Task2::class
    ],
];
```
Поместить чувствительные к времени задачи в `process/Task1.php`, а другие задачи в `process/Task2.php`.

### Больше информации
Для получения дополнительной информации о настройке в `config/process.php` обратитесь к [Custom Process](../process.md)
