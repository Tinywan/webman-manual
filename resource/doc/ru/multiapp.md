# Множественные приложения
Иногда проект может быть разделен на несколько подпроектов, например, магазин может быть разделен на основной проект магазина, API-интерфейс магазина и административную панель магазина, которые все используют одинаковую конфигурацию базы данных.

webman позволяет вам организовать каталог приложений следующим образом:
```
app
├── shop
│   ├── controller
│   ├── model
│   └── view
├── api
│   ├── controller
│   └── model
└── admin
    ├── controller
    ├── model
    └── view
```
Когда вы обращаетесь по адресу `http://127.0.0.1:8787/shop/{контроллер}/{метод}`, вы обращаетесь к контроллеру и методу в `app/shop/controller`.

Когда вы обращаетесь по адресу `http://127.0.0.1:8787/api/{контроллер}/{метод}`, вы обращаетесь к контроллеру и методу в `app/api/controller`.

Когда вы обращаетесь по адресу `http://127.0.0.1:8787/admin/{контроллер}/{метод}`, вы обращаетесь к контроллеру и методу в `app/admin/controller`.

В webman даже можно организовать каталог приложений таким образом.
```
app
├── controller
├── model
├── view
│
├── api
│   ├── controller
│   └── model
└── admin
    ├── controller
    ├── model
    └── view
```
Таким образом, когда адрес содержит `http://127.0.0.1:8787/{контроллер}/{метод}`, обращение будет происходить к контроллеру и методу в `app/controller`. Когда путь начинается с `api` или `admin`, обращение будет происходить к соответствующему каталогу.

При множественных приложениях пространство имен классов должно соответствовать `psr4`, например класс файла `app/api/controller/FooController.php` выглядит примерно так:

```php
<?php
namespace app\api\controller;

use support\Request;

class FooController
{
    
}

```

## Настройка промежуточных обработчиков для множественных приложений
Иногда вам может потребоваться настроить различные промежуточные обработчики для разных приложений, например, приложение `api` может потребоваться промежуточное обработчиком для кросс-доменных запросов, в то время как `admin` может потребоваться для проверки входа администратора. В этом случае конфигурация `config/midlleware.php` может выглядеть примерно так:

```php
return [
    // Глобальные промежуточные обработчики
    '' => [
        support\middleware\AuthCheck::class,
    ],
    // Промежуточные обработчики для приложения api
    'api' => [
         support\middleware\AccessControl::class,
     ],
    // Промежуточные обработчики для приложения admin
    'admin' => [
         support\middleware\AdminAuthCheck::class,
         support\middleware\SomeOtherClass::class,
    ],
];
```
> Эти промежуточные обработчики могут не существовать, здесь они приведены только в качестве примера для демонстрации настройки промежуточных обработчиков по приложениям

Порядок выполнения промежуточных обработчиков: `Глобальные промежуточные обработчики`->`промежуточные обработчики приложения`.

Разработка промежуточных обработчиков описана в разделе [Промежуточные обработчики](middleware.md)

## Настройка обработки исключений для множественных приложений
Аналогично, вам может потребоваться настроить различные классы обработки исключений для разных приложений. Например, если в приложении `shop` возникает исключение, вам может потребоваться предоставить дружественную страницу с сообщением об ошибке; если в приложении `api` возникает исключение, вам, возможно, нужно вернуть не страницу, а JSON-строку. Для настройки различных классов обработки исключений для различных приложений файл конфигурации `config/exception.php` может выглядеть примерно так:

```php
return [
    'shop' => support\exception\Handler::class,
    'api' => support\exception\ApiHandler::class,
];
```
> В отличие от промежуточных обработчиков, для каждого приложения можно настроить только один класс обработки исключений.

> Эти классы обработки исключений могут не существовать, здесь они приведены только в качестве примера для демонстрации настройки обработки исключений по приложениям

Разработка обработки исключений описана в разделе [Обработка исключений](exception.md)
