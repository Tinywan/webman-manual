# Guide de mise à niveau vers la version 1.4

**Avant de procéder à la mise à niveau, veuillez effectuer une sauvegarde et exécuter les commandes suivantes pour la mise à niveau :**
`composer require workerman/webman-framework ^1.4.7 && composer require webman/console ^1.2.12 && php webman install`

> **Remarque**
> Si la mise à niveau échoue, il est probable que cela soit dû à l'utilisation d'un proxy composer. Veuillez utiliser la commande suivante pour restaurer l'utilisation de la source officielle de composer : `composer config -g --unset repos.packagist`

# Fonctionnalités et changements

## Plugins d'application
La version 1.4 prend en charge les plugins d'application. Pour plus d'informations, veuillez consulter [Plugins d'application](../plugin/app.md).

## Routage automatique
La version 1.4 prend en charge diverses règles complexes de répertoires de contrôleurs, par exemple
```
app
├── admin
│   └── v1
│       └── v2
│           └── v3
│               └── controller
│                   └── Index.php
└── controller
    ├── v1
    │   └── Index.php
    └── v2
        └── v3
            └── Index.php
```
Cela signifie que le plugin `webman/auto-route` n'est plus nécessaire.

## Activation/désactivation de la réutilisation des contrôleurs
La version 1.4 permet de désactiver la réutilisation des contrôleurs en définissant `'controller_reuse' => false,` dans `config/app.php`. Ainsi, chaque requête initialisera un nouveau contrôleur, ce qui signifie que chaque requête déclenchera le constructeur `__construct()` correspondant du contrôleur pour effectuer un travail d'initialisation avant le traitement de chaque requête.

Étant donné qu'il est possible de désactiver la réutilisation des contrôleurs, le plugin `webman/action-hook` n'est plus nécessaire.

## Activation du service HTTP
La version 1.4 permet d'ouvrir plusieurs ports pour fournir des services HTTP. Voir [Traitement des tâches lentes](../others/task.md).

## Configuration des fichiers de vue
La configuration du suffixe ne peut être définie que dans l'option `view.php`. 
**Une utilisation obsolète :**
```php
use support\view\Raw;
return [
    'handler' => Raw::class,
    'view_suffix' => '.php'
];
```
**Utilisation correcte :**
```php
use support\view\Raw;
return [
    'handler' => Raw::class,
    'options' => [
        'view_suffix' => '.php'
    ]
];
```

## Changement de l'espace de noms du pilote de session
À partir de la version 1.4.0, webman a modifié l'espace de noms de la classe `SessionHandler` de la manière suivante :
```php
use Webman\FileSessionHandler;  
use Webman\RedisSessionHandler;  
use Webman\RedisClusterSessionHandler;  
```
est devenu
```php
use Webman\Session\FileSessionHandler;  
use Webman\Session\RedisSessionHandler;  
use Webman\Session\RedisClusterSessionHandler;
```

Afin d'éviter les erreurs directes après la mise à niveau, la classe `Webman\FileSessionHandler` est conservée pour une période. Elle sera complètement supprimée dans les versions futures.

Ce changement affecte la configuration `'handler'` de `config/session.php`.
