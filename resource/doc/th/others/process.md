# กระบวนการการทำงาน

## กระบวนการเริ่มต้นของกระบวนการ

หลังจากการดำเนินการ php start.php start กระบวนการถูกดำเนินการตามลำดับดังนี้:

1. โหลดการตั้งค่าในโฟลเดอร์ config/
2. ตั้งค่า Worker ที่เกี่ยวข้องเช่น `pid_file` `stdout_file` `log_file` `max_package_size` เป็นต้น
3. สร้างกระบวนการ webman และฟังก์ชันการฟังค์ชัน (default ที่ 8787)
4. สร้างกระบวนการที่กำหนดเองตามการตั้งค่า
5. เมื่อกระบวนการ webman และกระบวนการที่กำหนดเองเริ่มต้น ดำเนินการการเมื่ออยู่ในonWorkerStart ดังนี้:
   ① โหลดไฟล์ที่ถูกตั้งค่าใน `config/autoload.php` เช่น `app/functions.php`
   ② โหลด `config/middleware.php` (รวมถึง `config/plugin/*/*/middleware.php`) ที่ตั้งค่า Middleware
   ③ ดำเนินการการใน `config/bootstrap.php` (รวมถึง `config/plugin/*/*/bootstrap.php`) ที่ตั้งค่าเริ่มต้นคลาส start เพื่อทำการเริ่มต้นโมดูลบางส่วน เช่น เชื่อมต่อฐานข้อมูล Laravel
   ④ โหลดไฟล์ `config/route.php` (รวมถึง `config/plugin/*/*/route.php`) เพื่ินระบุเส้นทาง

## กระบวนการการดำเนินการคำขอ
1. ตรวจสอบว่า URL ของคำขอสติกและไฟล์อยู่ใน public หรือไม่ ถ้าใช่ให้คืนค่าไฟล์ (สิ้นสุดคำขอ) ถ้าไม่ใช่ให้ดำเนินการตามขั้นตอนที่ 2
2. ตรวจสอบ URL ว่าตรงกับเส้นทางไหร่ ถ้าไม่พบให้ดำเนินการตามขั้นตอนที่ 3 ถ้าพบให้ดำเนินการตามขั้นตอนที่ 4
3. การปิดเส้นทางเริ่มติดตามหรือไม่ ถ้าใช่ให้คืนค่า 404 (สิ้นสุดคำขอ) ถ้าไม่ใช่ให้ดำเนินการตามขั้นตอนที่ 4
4. ค้นหา Middleware ที่เกี่ยวข้องกับคำขอควบคุมการดำเนินการหน้าก่อน (onion model ระหว่างขั้นตอนการร้องขอ) ดำเนินการกระบวนการทางธุรกิจตามลำดับ ดำเนินการจากธุรกิจควบคุมหลัง(onion model หลังการเรียกตอบ) และสิ้นสุดคำขอ (ดูเพิ่มเติมใน [Middleware Onion Model](https://www.workerman.net/doc/webman/middleware.html#%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%B4%8B%E8%91%B1%E6%A8%A1%E5%9E%8B))
