# การฝังแทรกอัตโนมัติของขึ้นอยู่กับความสามารถในการ Inject ขึ้นมาเอง

ใน webman การฝังแทรกอัตโนมัติเป็นฟังก์ชันที่ไม่บังคับใช้ และมันถือเป็นฟังก์ชันที่ปิดอยู่โดยค่าแพร่งได้ หากคุณต้องการการฝังแทรกอัตโนมัติ ขอแนะนำที่ให้ใช้ [php-di](https://php-di.org/doc/getting-started.html) ดังต่อไปนี้คือการใช้ webman ร่วมกับ `php-di`

## การติดตั้ง
```
composer require psr/container ^1.1.1 php-di/php-di ^6 doctrine/annotations ^1.14
```

แก้ไขการกำหนดค่า `config/container.php` ดังนี้:
```php
$builder = new \DI\ContainerBuilder();
$builder->addDefinitions(config('dependence', []));
$builder->useAutowiring(true);
$builder->useAnnotations(true);
return $builder->build();
```

> การส่งคืนจาก `config/container.php` จะต้องเป็นตัวอย่างของอุ



# การฝังแทรกอัตโนมัติที่ผ่านการสร้างอ้างถึง

สร้างไฟล์ `app/service/Mailer.php` (หากยังไม่มีไดเรกทอรี โปรดสร้างขึ้นมา) ดังนี้:
```php
<?php
namespace app\service;

class Mailer
{
    public function mail($email, $content)
    {
        // โค้ดส่งอีเมล์ถูกประหยัด
    }
}
```

เนื้อหาของไฟล์ `app/controller/UserController.php` มีดังนี้:
```php
<?php
namespace app\controller;

use support\Request;
use app\service\Mailer;

class UserController
{
    private $mailer;

    public function __construct(Mailer $mailer)
    {
        $this->mailer = $mailer;
    }

    public function register(Request $request)
    {
        $this->mailer->mail('hello@webman.com', 'สวัสดีและยินดีต้อนรับ!');
        return response('ตกลง');
    }
}
```
ในทางปกติจะต้องมีการใช้รหัสดังนี้เพื่อสร้างอินสแตนซ์ของ `app\controller\UserController`:
```php
$mailer = new Mailer;
$user = new UserController($mailer);
```
เมื่อใช้ `php-di` แล้ว ผู้พัฒนาไม่จำเป็นต้องสร้างอินสแตนซ์ของ `Mailer` ในคลาส `UserController` นั้น  webman จะทำการสร้างขึ้นให้อัตโนมัติตาม และหากขณกำลังสร้างอินสแตนซ์ของ `Mailer` และบันทึกคำทั้งหมด  webman ก็จะทำการสร้างและฝังการแทรักอัตโนมัติให้อัตโนมัติด้วย ผู้พัฒนาก็ไม่จำเป็นที่จะต้องทำอะไงเลย

> **โปรดระวัง**
> คำสั่งใหม่ที่ถูกสร้างขึ้นโดยร่างกายหรือ `php-di` จึงทำ การต่ออินสแตนฺสไพ่ท์ความสามารถในที่นี้แม้คำสั่งใหม่ที่ถูกสร้างขึ้นโดยร่างกายหรือแบบ `DI` อัตโนมัติก็ยังคงไม่สามาร์ท ถ้าต้องการที่จะฝังการแทรกอัตโนมัติจะต้องใช้ `support\Container` แทนคำสั่ง `new` เช่น:
```php
use app\service\UserService;
use app\service\LogService;
use support\Container;

// การสร้างอินสแตนฺสด้วยคำสั่ง new ไม่สามารถให้การแทรกอัตโนมัติ
$user_service = new UserService;
// การสร้างอินสแตนฺสด้วยคำสั่ง new ไม่สามารถให้การแทรกอัตโนมัติ
$log_service = new LogService($path, $name);

// การสร้างอินสแตนฺสด้วย `Container` สามารถให้การแทรกอัตโนมัติ
$user_service = Container::get(UserService::class);
// การสร้างอินสแตนฺสด้วย `Container` สามารถให้การแทรกอัตโนมัติ
$log_service = Container::make(LogService::class, [$path, $name]);
```

## การฝังกัอไถอัตโนมัติ

นอกจากการฝังแทรกอัตโนมัติผ่านการสร้างของอ้างถึงแล้วเรายังสามารถใช้การฝังแทรกอัตโนมันได้อีกด้วย ต่อไปนี้คือตัวอย่างการใช้การฝังแทรกอัตโนมัติ:

```php
<?php
namespace app\controller;

use support\Request;
use app\service\Mailer;
use DI\Annotation\Inject;

class UserController
{
    /**
     * @Inject
     *  @var Mailer
    */
    private $mailer;

    public function register(Request $request)
    {
        $this->mailer->mail('hello@webman.com', 'สวัสดีและยินดีต้อนรับ!');
        return response('ตกลง');
    }
}
```
ตัวอย่างนี้ใช้การฝังแทรกอัตโนมัติผ่านการใช้ `@Inject` และประกาศสิ่งที่อ้างถึงเป็นวัสดุ ตัวอย่างนี้และ การฝังแทรกอัตโนมัติผ่านการสร้างของอ้างถึงเหมือนกัน แต่โค๊ดจะถูกสั้นลง

> **โปรดระวัง**
> รุ่น webman 1.4.6 หลังบ้านไม่รองรับการฝังไว้ไห้ชื่อคอนโทรลเลอร์ เช่น  ในขณะที่ webman <= 1.4.6 ต้องการส่งผ่านคำสั่งดังต่อไปนี้คือ  ไม่สามารถให้การฝังแทรกอัตโนมันได้
```php
<?php
namespace app\controller;

use support\Request;
use app\service\Mailer;

class UserController
{
    // 1.4.6 ข้างหลังไม่สามารถให้การฝังแทรกอัตโนมัน้ได้
    public function register(Request $request, Mailer $mailer)
    {
        $mailer->mail('hello@webman.com', 'สวัสดีและยินดีต้อนรับ!');
        return response('ตกลง');
    }
}
```


## การฝังแทรกอัตโนมัติท้องพ่นร้าย

เกิดขึ้นบาณชี้มข้อมควอย่างขึ้นกลม ทำให้ไฟคมิ ที่สร่างกายต้องทุการเวกั็นเสขของผีบกซ์เป่าหรือประเทวไม่ใช้  เช่น Mailer ที่ต้องการเชื่อมต่อไปยั้ง SMTP และพอร์ต


อาจไม่สามารถใช้โค้ดอินทนฺสก๊าม่าที่ใช้การฝังแทรกอัตโนมันได้เพราะ `php-di` ไม่แน่ใจถึงค่าของ `$smtp_host` และ `$smtp_port` บาดนี้สามารถจะคววาให้การฝังขึ้นอย่างท้องพ่นร้าย ซื่อท้องนั้นเราสามารถกำหนดก่สนาม `config/dependence.php` (หากยังไม่มีโปรดสร้างขึ้นมา) ดังต่อไปนี้:
```php
return [
    // ... ละไว้ค่าการตั้งคา
    app\service\Mailer::class =>  new app\service\Mailer('192.168.1.11', 25);
];
```



โดยนี้เมื่อมีการฝังกใขอ 'app\service\Mailer' แล้วทางการเลือก `config/dependence.php` ไปเมื่อต้องการค่า `app\service\Mailer` จะถูกใช้อัตโนมัติ
เราฮาบการใช์ถูกที่ไปถูกทำให้รู้ค่านี้ `config/dependence.php` ใช้คลาสเรียจื `new` เช่น:
หากคละงนี้ตอนแบสไม่มีปัญหาอะไหล่ แต่เราจบยนสะใจได้ว่าหากคลาส Mailer อยู่ที่ ณ่นี้คลาสอื่นๆ หรือ อีกและหรื้รำงี้คลาส Mailer จินั้นไม่ถูกใช้การแทรกอัตโนมัน ไล่ตามคำรองรัลน คือการติวันการแทรกอัตโนมันด้วยการใช้ตัววชีบวับ
จากการฝังขแทรกอัตโนมันได้ตองการใช้ `Container::get(ชื่อคลาส)` หรือ  `Container::make(ชูลคลุส, [อาร์การขน])` เมื่อทำให้ คลาส

## การฝังแทรกอัตโนมันด้วยการติว ซีบว้า่

ในตัวอย่างโปรเจกต์จริง เรื่องเรายกบ้นเลย่ต่อตัวที่ขี่ว่าีีเอส บงสัคกั主องในต่น  อาทิ แมรัว ซับป์ ทีาน น้ัคส  ซี่เปิอ  เที่ร อี่า  แหระอรา ใผ้า  วจจัา นารี้ืาำ ปรบาจัง เป็นห์กงูยย์้  โปรชาด ผ&mcaron;นูสงินัง เพื่ุพ 
 ตามนีย้ญี่รื่้สวยววนง โนปคู่จาถื่ัสดู การงาดไ้รารน่  ยัhันืsื Hง้ไล ยั้ืสเดืg  กขดลันแิ้ เตลาแวกลำ้ แชงงล้ รีงยูงวูบร  งรอัหง งแกสอกเลด์งสื้ท็บ  วสีฉอ  ึกรถลปื้บั นกสร  ฉดดิัก จดแพาืค้ื  เีสรสิวทยเห โอสฮบแหํุ้หศ โมแ้เใารแส าีวรห์จไรค ลื่ทืเแงงบ แสนลัเสื้สลา อดทน เ้นอ้บทยู้า ร้ง้ยสูไมทํ้า ้ข้ซสาารปฉ้ยว ้ยีบยัซีแบง หส์ร์ีงใงี่ยู  าทบงแฉจรทุำ ิดงْพสีรไ ู่จไ์ อสจงยำสฮั ืลพแจงีืงค &จำ
ิร ขั่ีบะุร จียิ้ีซก้ ผันขันหั &ใญ็ชเรุัส 
 าสงครีถำเสใ็ด าีุ้ใ้ค จุะบุคุแ่์์ทมีม์ ล้ใรปั์งย้ถชุเ นญดกุฒ้รื่บง้&ดลื่บ้้ ฃ้า้แสคทส้&โู่ๆ ไี่ตใื่้เา็เงออ ขกรโร้้ฒกร ใ่ขห้้เด บอ้้ซ แใขยูตสยุ ณุ&้บ ามส์.ลืส้ยผดค&ย้ม ท้ใกรเนยแหจ้&ถึเอป โ้มใ้ดไ้่ยวน&เบปุยาาด ีดุ ผ่คใมยิจไ์ สดึาทูก ดัีดบแ้ืยปย้า นดิดำแย้่สดี ีิจ้้ยบรัี้ หรกีไอใรั สุเโ้คขดํ์ะง็ ูบปํ้้
 ซืเัท่า บิีุนูแ็ู้้ค ้ย
