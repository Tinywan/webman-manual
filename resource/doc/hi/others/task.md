# धीमा व्यापार प्रसंस्करण

कभी-कभी हमें धीमे व्यापार का संबोधन करने की आवश्यकता होती है, ताकि धीमे व्यापार का अन्य अनुरोध प्रसंस्करण पर प्रभाव ना पड़े, इन व्यापारों के संबंध में विभिन्न समाधानों का उपयोग किया जा सकता है।

## संदेश कतार का उपयोग
में [redis queue](https://www.workerman.net/plugin/12) [stomp queue](https://www.workerman.net/plugin/13) को देखें।

### लाभ
अचानक मात्रा में व्यापार प्रसंस्करण अनुरोधों का सामना कर सकता है

### हानि
सीधे ग्राहक को परिणाम लौटा नहीं सकता। परिणाम पुश करने की आवश्यकता होती है, जैसे की वेबमैन/पुश (https://www.workerman.net/plugin/2) परिणाम को पुश करने के लिए।

## नया HTTP पोर्ट जोड़ें

> **ध्यान दें**
> यह विशेषता webman-framework>=1.4 की आवश्यकता है

धीमे अनुरोध को संबोधित करने के लिए एक नया HTTP पोर्ट जोड़ें, इन धीमे अनुरोधों का इस पोर्ट के माध्यम से एक विशेष प्रकार के प्रक्रिया द्वारा प्रसंस्करण किया जाता है, प्रसंस्करण के बाद परिणाम सीधे ग्राहक को लौटाया जाता है।

### लाभ
डेटा को सीधे ग्राहक को वापस भेजा जा सकता है

### हानियाँ
अचानक मात्रा के अनुरोधों का सामना नहीं कर सकते हैं

### कार्यान्वयन कदम
`config/process.php` में निम्नलिखित विन्यास जोड़ें।
```php
return [
    // ... यहाँ अन्य सेटिंग छूट गई है ...
    
    'task' => [
        'handler' => \Webman\App::class,
        'listen' => 'http://0.0.0.0:8686',
        'count' => 8, // प्रक्रिया संख्या
        'user' => '',
        'group' => '',
        'reusePort' => true,
        'constructor' => [
            'request_class' => \support\Request::class, // अनुरोध कक्ष सेटिंग
            'logger' => \support\Log::channel('default'), // लॉग उदाहरण
            'app_path' => app_path(), // ऐप पथ स्थान
            'public_path' => public_path() // सार्वजनिक पथ स्थान
        ]
    ]
];
```

इस प्रकार से धीमे इंटरफ़ेस  `http://127.0.0.1:8686/` इस प्रक्रिया समूह में चल सकते हैं, जो अन्य प्रक्रियाओं के व्यापार प्रसंस्करण को प्रभावित नहीं करते।

प्रारंभिक स्तर पर, फ्रंट-एंड को पोर्ट के अंतर को बेहोश करने के लिए, एक 8686 पोर्ट के प्रतिनिधित्व करने के लिए एक nginx में प्रॉक्सी जोड़ सकते हैं। मान लें कि धीमे इंटरफ़ेस अनुरोध पथ `/tast` से शुरू होते हैं, nginx का पूर्ण कॉन्फ़िगरेशन निम्नलिखित प्रकार पर हो सकता है:
```
upstream webman {
    server 127.0.0.1:8787;
    keepalive 10240;
}

# एक 8686 अपस्ट्रीम जोड़ें
upstream task {
   server 127.0.0.1:8686;
   keepalive 10240;
}

server {
  server_name webman.com;
  listen 80;
  access_log off;
  root /path/webman/public;

  # /tast से शुरू होने वाले अनुरोध 8686 पोर्ट पर जाएं, कृपया /tast को अपने आवश्यक प्रीफ़िक्स के अनुसार संशोधित करें
  location /tast {
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header Host $host;
      proxy_http_version 1.1;
      proxy_set_header Connection "";
      proxy_pass http://task;
  }

  # अन्य अनुरोधों को मूल 8787 पोर्ट पर जाने दें
  location / {
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header Host $host;
      proxy_http_version 1.1;
      proxy_set_header Connection "";
      if (!-f $request_filename){
          proxy_pass http://webman;
      }
  }
}
```

इस प्रकार, जब क्लाइंट `डोमेन.com/tast/xxx` पर जाता है, तो वह स्वतंत्र रूप से 8686 पोर्ट के प्रसंस्करण को संबोधित करता है, 8787 पोर्ट के अनुरोध प्रसंस्करण को प्रभावित नहीं करता है।
